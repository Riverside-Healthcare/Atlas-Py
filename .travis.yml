branches:
  except:
  - gh-pages
language: python
os: linux
dist: focal
jobs:
  include:
  - name: linux python 3.6
    python: 3.6
  - name: linux python 3.7
    python: 3.7
  - name: linux python 3.8
    python: 3.8
  - name: linux python 3.9
    python: 3.9
  - name: osx
    os: osx
    language: shell
    osx_image: xcode11.6
    before_install:
    - brew install libxmlsec1 redis
    - pyenv install 3.6.13
    - pyenv install 3.7.10
    - pyenv install 3.8.9
    - pyenv install 3.9.4
    - pyenv global 3.6.13 3.7.10 3.8.9 3.9.4
    before_script:
    - sudo rm -rf /usr/local/var/postgres
    - initdb /usr/local/var/postgres -E utf8 -U postgres
    - brew services start postgresql
    - sudo psql -c 'create database atlas;' -U postgres
    - brew services start redis
    script:
    - tox -e clean,py36,py37,py38,py39,cov
  - name: windows
    os: windows
    language: shell
    env: PGPASSWORD=12345
    before_install:
    - choco install postgresql13 --params '/Password:12345'
    - choco install python --version 3.9.5
    - choco install redis-64
    - C:/Python39/python.exe -m ensurepip
    install:
    - C:/Python39/python.exe -m pip install tox-travis poetry codecov
    before_script:
    - C:/"Program Files"/PostgreSQL/13/bin/psql.exe -c 'create database atlas;' -U
      postgres
    - C:/"Program Files"/PostgreSQL/13/bin/psql.exe -c '\l' -U postgres
    script:
    - C:/Python39/python.exe -m tox -e clean,test,cov
    after_success: echo "ok"
  - name: browser stack
    python: 3.8
    env:
    - BROWSERSTACK_BUILD_NAME="$TRAVIS_COMMIT"
    - BROWSERSTACK_PROJECT_NAME="Atlas Py"
    addons:
      postgresql: '13'
      browserstack:
        username: "$BROWSERSTACK_USERNAME"
        access_key:
          secure: g+ltXk6GtTagTc2KK/+6ck72kWjkIS/0rAUZ3Sh5QnrVqEDXI3V3U9i6D0UojWO7KidkJE+5MLno/xkY8u2i5QUQb8SOL4k4xSFDfOrIqyeQspvxwqK1wAjK/pzv2cruWqtqiW0QfMWTWg9RLhjPiUAV9iKZM3dU7LE17cgnc8ABY+VzXrdsrSettX0XYGnk+nA3blCJnYuuO9BdwdBLXTrfOsnTkZgPpKzi1+eJkgH1hmjrKq2Rfd6wkGjdyUdY0IoEq3uliPgFv6tUItgqfd2gQedSNgIvxs6TqZ8N9jV+WpdvWMPp3N+fBO562ARiw0RvcXiT5kwaY3qPXF0eizPa02XKbbNNhtqYXtIccOpZqBZsQe7NR/5eykAjiWCpTyxiZjAYkOWN5t7cYe+SEnBlShN+TJWe5jqmI7Lx7BLjRNEk7yPkYSJhsmb2vHql2252SvOL4qY9R6cfV33eKX3Bq3pqGdbuR8a52lu64eySmSdpzCE92Hm8azbzRSmnHYgnX1p2QrFZeyISNrxvhVqwo0n5TaE54PYEaTMqLxERDpG/zlXiXYnuyQp+wbajxOMBtbR9pUWGrQQe7niElFNhCZtNwomS5ytru1nlYVZwX15sg8LTz9A2Vpr3eXT8lGiURs8t8LK5vdyFF0Jl0w1hpI4iprZU9essZ5x7aAo=
    script:
    - tox -e clean,browsertest,cov
services:
- redis
addons:
  postgresql: '13'
before_install:
- sudo apt-get install libxml2-dev libxmlsec1-dev libxmlsec1-openssl
install:
- python -m pip install tox-travis poetry codecov
- python --version
script:
- tox -e clean,test,cov
after_success:
- codecov
notifications:
  email:
    on_success: change
    on_failure: always

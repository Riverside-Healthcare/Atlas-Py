"use strict";function e(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}!function(){window.ajaxOn=!0;var e,t,n=new Date,i=function(e){var t={},i=navigator,s=window,a=document,u=s.location;return t.language=i.language,t.userAgent=i.userAgent,t.host=u.host,t.hostname=u.hostname,t.href=u.href,t.protocol=u.protocol,t.search=u.search,t.pathname=u.pathname,t.screenHeight=a.documentElement.clientHeight,t.screenWidth=a.documentElement.clientWidth,t.origin=s.origin,t.referrer=a.referrer,t.loadTime=e||s.performance.timing.domContentLoadedEventEnd-s.performance.timing.navigationStart,t.zoom=s.devicePixelRatio,t.sessionId=r(),t.pageId=o(),t.pageTime=Date.now()-n.getTime(),t},r=function(e){return"clear"===e?(sessionStorage.removeItem("_sid"),!1):(("reset"===e||void 0===sessionStorage._sid)&&(sessionStorage._sid=btoa(new Date().toString()),o("reset"),n=new Date),sessionStorage._sid)},o=function(e){return("reset"===e||void 0===sessionStorage._pid)&&(n=new Date,sessionStorage._pid=btoa(new Date().toString())),sessionStorage._pid},s=function(e,t){if("newpage"===t&&(o("reset"),window.ajaxOn=!0),!0===window.ajaxOn){if(navigator.sendBeacon)navigator.sendBeacon("/analytics/log",JSON.stringify(i(e)));else{var n=new XMLHttpRequest;n.open("post","/analytics/log",!0),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8`"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("X-CSRFToken",csrftoken),n.send(JSON.stringify(i(e)))}}l()},a=function(){e=window.setTimeout(h,12e4),r()},u=function(){debounce(void(window.clearTimeout(e),a(),window.ajaxOn=!0),500)},h=function(){window.ajaxOn=!1,r("clear"),sessionStorage.clear()},c=function(){document.addEventListener("mousemove",u,!1),document.addEventListener("mousedown",u,!1),document.addEventListener("keypress",u,!1),document.addEventListener("touchmove",u,!1),document.addEventListener("scroll",u,{passive:!0},!1),a()},f=function(){t=window.setTimeout(s,3e4)},l=function(){window.clearTimeout(t),f()};"complete"===document.readyState&&(c(),s(0,"newpage")),window.addEventListener("load",function(){c(),s(0,"newpage")},!1),document.addEventListener("analytics-post",function(e){void 0!==e.detail&&s(e.detail.value,e.detail.type)})}();var t,n=function(){var t=function(n,i){return(t=Object.setPrototypeOf||e({__proto__:[]},Array)&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(n,i)};return function(e,n){var i=function(){this.constructor=e};t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();function i(e){if(!e)return i.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,i=0;i<this.length;i++)n=e(n,this[i],i,this);return n});var t="";return("."+e).split(".").reduce(function(e,n,r,o){t?t+="."+n:t=n;var s=e["__"+t];return void 0===s&&(i.Logger.prototype=e,s=new i.Logger(t),e["__"+t]=s),s},i.__)}!function(t){var i,r,o,s=function(e,t,n){if(void 0!==t[e]){if(null===t[e]){delete n[e];return}n[e]=t[e]}},a=function(e){if(null!=t.enabled&&!t.enabled)return!1;try{if(e.userAgentRegex&&!RegExp(e.userAgentRegex).test(navigator.userAgent))return!1}catch(n){}try{if(e.ipRegex&&t.clientIP&&!RegExp(e.ipRegex).test(t.clientIP))return!1}catch(i){}return!0},u=function(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(n){}return!0},h=function(t){return"function"==typeof t?e(t,RegExp)?t.toString():t():t},c=function(n){var i,r,o=h(n);switch(void 0===o?"undefined":o&&"undefined"!=typeof Symbol&&o.constructor===Symbol?"symbol":typeof o){case"string":return new B(o,null,o);case"number":case"boolean":return r=o.toString(),new B(r,null,r);case"undefined":return new B("undefined",null,"undefined");case"object":if(e(o,RegExp)||e(o,String)||e(o,Number)||e(o,Boolean))return r=o.toString(),new B(r,null,r);return r="function"==typeof t.serialize?t.serialize.call(this,o):JSON.stringify(o),new B("",o,r);default:return new B("unknown",null,"unknown")}},f=function(e){return s("enabled",e,this),s("maxMessages",e,this),s("defaultAjaxUrl",e,this),s("clientIP",e,this),s("requestId",e,this),s("defaultBeforeSend",e,this),s("serialize",e,this),this},l=function(){return -2147483648},d=function(){return 1e3},g=function(){return 2e3},p=function(){return 3e3},m=function(){return 4e3},b=function(){return 5e3},w=function(){return 6e3},v=function(){return 2147483647},y=function(e,n,i){return t.entryId++,new T(e,n,i,t._getTime(),t.entryId)},x=function(e){e.id&&(clearTimeout(e.id),e.id=null)},S=function(e,t,n){var i=this;e.id||(e.id=setTimeout(function(){n.call(i)},t))},L=function(e){return new R(e)},_=function(e){return new O(e)};t.requestId="",t.entryId=0,t._createXMLHttpRequest=function(){return new XMLHttpRequest},t._getTime=function(){return(new Date).getTime()},t._console=console,t._appenderNames=[];var B=function(e,t,n){this.msg=e,this.meta=t,this.finalString=n};t.setOptions=f,t.getAllLevel=l,t.getTraceLevel=d,t.getDebugLevel=g,t.getInfoLevel=p,t.getWarnLevel=m,t.getErrorLevel=b,t.getFatalLevel=w,t.getOffLevel=v;var I=function(e,t){this.inner=t,this.name="JL.Exception",this.message=c(e).finalString};t.Exception=I,I.prototype=Error();var T=function(e,t,n,i,r){this.l=e,this.m=t,this.n=n,this.t=i,this.u=r};t.LogItem=T;var E=((i=function(e,n){this.appenderName=e,this.sendLogItems=n,this.level=t.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var i="Trying to create an appender without a name or with an empty name";if(void 0==e)throw i;if(-1!=t._appenderNames.indexOf(e)){if(!e)throw i;throw"Multiple appenders use the same name "+e}t._appenderNames.push(e)}).prototype.addLogItemsToBuffer=function(e){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=e.length;return}if(null!=t.maxMessages){if(t.maxMessages<1)return;t.maxMessages-=e.length}this.batchBuffer=this.batchBuffer.concat(e);var n=this;S(this.batchTimeoutTimer,this.batchTimeout,function(){n.sendBatch.call(n)})},i.prototype.batchBufferHasOverdueMessages=function(){for(var e=0;e<this.batchBuffer.length;e++)if(t._getTime()-this.batchBuffer[e].t>this.batchTimeout)return!0;return!1},i.prototype.batchBufferHasStrandedMessage=function(){return null!=t.maxMessages&&t.maxMessages<1&&this.batchBuffer.length>0},i.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},i.prototype.onSendingEnded=function(){x(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},i.prototype.setOptions=function(e){if(s("level",e,this),s("ipRegex",e,this),s("userAgentRegex",e,this),s("disallow",e,this),s("sendWithBufferLevel",e,this),s("storeInBufferLevel",e,this),s("bufferSize",e,this),s("batchSize",e,this),s("maxBatchSize",e,this),s("batchTimeout",e,this),s("sendTimeout",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new t.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},i.prototype.log=function(e,t,n,i,r,o,s){var h;if(a(this)&&u(this,o)&&!(r<this.storeInBufferLevel)){if(h=y(r,o,s),r<this.level){this.bufferSize>0&&(this.buffer.push(h),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([h]),r>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},i.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)){if(x(this.batchTimeoutTimer),0!=this.batchBuffer.length){this.nbrLogItemsBeingSent=this.batchBuffer.length;var e=this;S(this.sendTimeoutTimer,this.sendTimeout,function(){e.onSendingEnded.call(e)}),this.sendLogItems(this.batchBuffer,function(){e.batchBuffer.splice(0,e.nbrLogItemsBeingSent),e.nbrLogItemsSkipped>0&&(e.batchBuffer.push(y(m(),"Lost "+e.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",e.appenderName)),e.nbrLogItemsSkipped=0),e.onSendingEnded.call(e)})}}},i);t.Appender=E;var R=function(e){function i(t){return e.call(this,t,i.prototype.sendLogItemsAjax)||this}return n(i,e),i.prototype.setOptions=function(t){return s("url",t,this),s("beforeSend",t,this),e.prototype.setOptions.call(this,t),this},i.prototype.sendLogItemsAjax=function(e,n){try{if(!a(this))return;this.xhr&&0!=this.xhr.readyState&&4!=this.xhr.readyState&&this.xhr.abort(),this.xhr=t._createXMLHttpRequest();var i="/jsnlog.logger";null!=t.defaultAjaxUrl&&(i=t.defaultAjaxUrl),this.url&&(i=this.url),this.xhr.open("POST",i),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",t.requestId);var r=this;this.xhr.onreadystatechange=function(){4==r.xhr.readyState&&r.xhr.status>=200&&r.xhr.status<300&&n()};var o={r:t.requestId,lg:e};"function"==typeof this.beforeSend?this.beforeSend.call(this,this.xhr,o):"function"==typeof t.defaultBeforeSend&&t.defaultBeforeSend.call(this,this.xhr,o);var s=JSON.stringify(o);this.xhr.send(s)}catch(u){}},i}(E);t.AjaxAppender=R;var O=function(e){function i(t){return e.call(this,t,i.prototype.sendLogItemsConsole)||this}return n(i,e),i.prototype.clog=function(e){t._console.log(e)},i.prototype.cerror=function(e){t._console.error?t._console.error(e):this.clog(e)},i.prototype.cwarn=function(e){t._console.warn?t._console.warn(e):this.clog(e)},i.prototype.cinfo=function(e){t._console.info?t._console.info(e):this.clog(e)},i.prototype.cdebug=function(e){t._console.debug?t._console.debug(e):this.cinfo(e)},i.prototype.sendLogItemsConsole=function(e,n){try{if(!a(this)||!t._console)return;for(i=0;i<e.length;++i){var i,r=e[i],o=r.n+": "+r.m;"undefined"==typeof window&&(o=new Date(r.t)+" | "+o),r.l<=t.getDebugLevel()?this.cdebug(o):r.l<=t.getInfoLevel()?this.cinfo(o):r.l<=t.getWarnLevel()?this.cwarn(o):this.cerror(o)}}catch(s){}n()},i}(E);t.ConsoleAppender=O;var j=((r=function(e){this.loggerName=e,this.seenRegexes=[]}).prototype.setOptions=function(e){return s("level",e,this),s("userAgentRegex",e,this),s("disallow",e,this),s("ipRegex",e,this),s("appenders",e,this),s("onceOnly",e,this),this.seenRegexes=[],this},r.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},r.prototype.log=function(e,t,n){var i,r,o,s=0;if(!this.appenders)return this;if(e>=this.level&&a(this)&&(n?(o=this.buildExceptionObject(n)).logData=h(t):o=t,r=c(o),u(this,r.finalString))){if(this.onceOnly)for(s=this.onceOnly.length-1;s>=0;){if(RegExp(this.onceOnly[s]).test(r.finalString)){if(this.seenRegexes[s])return this;this.seenRegexes[s]=!0}s--}for(r.meta=r.meta||{},s=this.appenders.length-1;s>=0;)this.appenders[s].log((i=e)<=1e3?"trace":i<=2e3?"debug":i<=3e3?"info":i<=4e3?"warn":i<=5e3?"error":"fatal",r.msg,r.meta,function(){},e,r.finalString,this.loggerName),s--}return this},r.prototype.trace=function(e){return this.log(d(),e)},r.prototype.debug=function(e){return this.log(g(),e)},r.prototype.info=function(e){return this.log(p(),e)},r.prototype.warn=function(e){return this.log(m(),e)},r.prototype.error=function(e){return this.log(b(),e)},r.prototype.fatal=function(e){return this.log(w(),e)},r.prototype.fatalException=function(e,t){return this.log(w(),e,t)},r);t.Logger=j,t.createAjaxAppender=L,t.createConsoleAppender=_,o="undefined"!=typeof window?new R(""):new O(""),t.__=new t.Logger(""),t.__.setOptions({level:t.getDebugLevel(),appenders:[o]})}(i||(i={})),"undefined"!=typeof exports&&(exports.__esModule=!0,exports.JL=i),"function"==typeof t&&t.amd&&t("jsnlog",[],function(){return i}),"function"==typeof __jsnlog_configure&&__jsnlog_configure(i),"undefined"==typeof window||window.onerror||(window.onerror=function(e,t,n,r,o){return i("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:e?e.message||e:"",url:t,"line number":n,column:r},o),!1}),"undefined"==typeof window||window.onunhandledrejection||(window.onunhandledrejection=function(e){i("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:e.reason?e.reason.message:e.message||null},e.reason)});
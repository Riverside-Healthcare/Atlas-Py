"use strict";function e(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var t,n=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){window.ajaxOn=!0;var e,t,n=new Date,i=function(e){var t={},i=navigator,o=window,a=document,h=o.location;return t.language=i.language,t.userAgent=i.userAgent,t.host=h.host,t.hostname=h.hostname,t.href=h.href,t.protocol=h.protocol,t.search=h.search,t.pathname=h.pathname,t.screenHeight=a.documentElement.clientHeight,t.screenWidth=a.documentElement.clientWidth,t.origin=o.origin,t.referrer=a.referrer,t.loadTime=e||o.performance.timing.domContentLoadedEventEnd-o.performance.timing.navigationStart,t.zoom=o.devicePixelRatio,t.sessionId=r(),t.pageId=s(),t.pageTime=Date.now()-n.getTime(),t},r=function(e){return"clear"===e?(sessionStorage.removeItem("_sid"),!1):(("reset"===e||void 0===sessionStorage._sid)&&(sessionStorage._sid=btoa(new Date().toString()),s("reset"),n=new Date),sessionStorage._sid)},s=function(e){return("reset"===e||void 0===sessionStorage._pid)&&(n=new Date,sessionStorage._pid=btoa(new Date().toString())),sessionStorage._pid},o=function(e,t){if("newpage"===t&&(s("reset"),window.ajaxOn=!0),!0===window.ajaxOn){if(navigator.sendBeacon)navigator.sendBeacon("/analytics/log",JSON.stringify(i(e)));else{var n=new XMLHttpRequest;n.open("post","/analytics/log",!0),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8`"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("X-CSRFToken",csrftoken),n.send(JSON.stringify(i(e)))}}l()},a=function(){e=window.setTimeout(u,12e4),r()},h=function(){debounce(void(window.clearTimeout(e),a(),window.ajaxOn=!0),500)},u=function(){window.ajaxOn=!1,r("clear"),sessionStorage.clear()},f=function(){document.addEventListener("mousemove",h,!1),document.addEventListener("mousedown",h,!1),document.addEventListener("keypress",h,!1),document.addEventListener("touchmove",h,!1),document.addEventListener("scroll",h,{passive:!0},!1),a()},c=function(){t=window.setTimeout(o,3e4)},l=function(){window.clearTimeout(t),c()};"complete"===document.readyState&&(f(),o(0,"newpage")),window.addEventListener("load",function(){f(),o(0,"newpage")},!1),document.addEventListener("analytics-post",function(e){void 0!==e.detail&&o(e.detail.value,e.detail.type)})}();var i=function(){var t=function(n,i){return(t=Object.setPrototypeOf||e({__proto__:[]},Array)&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(n,i)};return function(e,n){var i=function(){this.constructor=e};t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();function r(e){if(!e)return r.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,i=0;i<this.length;i++)n=e(n,this[i],i,this);return n});var t="";return("."+e).split(".").reduce(function(e,n,i,s){t?t+="."+n:t=n;var o=e["__"+t];return void 0===o&&(r.Logger.prototype=e,o=new r.Logger(t),e["__"+t]=o),o},r.__)}!function(t){var r,s=function(e,t,n){if(void 0!==t[e]){if(null===t[e]){delete n[e];return}n[e]=t[e]}},o=function(e){if(null!=t.enabled&&!t.enabled)return!1;try{if(e.userAgentRegex&&!RegExp(e.userAgentRegex).test(navigator.userAgent))return!1}catch(n){}try{if(e.ipRegex&&t.clientIP&&!RegExp(e.ipRegex).test(t.clientIP))return!1}catch(i){}return!0},a=function(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(n){}return!0},h=function(t){return"function"==typeof t?e(t,RegExp)?t.toString():t():t},u=function(i){var r,s=h(i);switch(void 0===s?"undefined":n(s)){case"string":return new I(s,null,s);case"number":case"boolean":return r=s.toString(),new I(r,null,r);case"undefined":return new I("undefined",null,"undefined");case"object":if(e(s,RegExp)||e(s,String)||e(s,Number)||e(s,Boolean))return r=s.toString(),new I(r,null,r);return r="function"==typeof t.serialize?t.serialize.call(this,s):JSON.stringify(s),new I("",s,r);default:return new I("unknown",null,"unknown")}},f=function(e){return s("enabled",e,this),s("maxMessages",e,this),s("defaultAjaxUrl",e,this),s("clientIP",e,this),s("requestId",e,this),s("defaultBeforeSend",e,this),s("serialize",e,this),this},c=function(){return -2147483648},l=function(){return 1e3},p=function(){return 2e3},d=function(){return 3e3},g=function(){return 4e3},m=function(){return 5e3},$=function(){return 6e3},v=function(){return 2147483647},y=function(e){return e<=1e3?"trace":e<=2e3?"debug":e<=3e3?"info":e<=4e3?"warn":e<=5e3?"error":"fatal"},b=function(e,n,i){return t.entryId++,new _(e,n,i,t._getTime(),t.entryId)},x=function(e){e.id&&(clearTimeout(e.id),e.id=null)},L=function(e,t,n){var i=this;e.id||(e.id=setTimeout(function(){n.call(i)},t))},S=function(e){return new O(e)},B=function(e){return new A(e)};t.requestId="",t.entryId=0,t._createXMLHttpRequest=function(){return new XMLHttpRequest},t._getTime=function(){return(new Date).getTime()},t._console=console,t._appenderNames=[];var I=function(e,t,n){this.msg=e,this.meta=t,this.finalString=n};t.setOptions=f,t.getAllLevel=c,t.getTraceLevel=l,t.getDebugLevel=p,t.getInfoLevel=d,t.getWarnLevel=g,t.getErrorLevel=m,t.getFatalLevel=$,t.getOffLevel=v;var w=function(e,t){this.inner=t,this.name="JL.Exception",this.message=u(e).finalString};t.Exception=w,w.prototype=Error();var T,_=function(e,t,n,i,r){this.l=e,this.m=t,this.n=n,this.t=i,this.u=r};t.LogItem=_;var E=((T=function(e,n){this.appenderName=e,this.sendLogItems=n,this.level=t.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var i="Trying to create an appender without a name or with an empty name";if(void 0==e)throw i;if(-1!=t._appenderNames.indexOf(e)){if(!e)throw i;throw"Multiple appenders use the same name "+e}t._appenderNames.push(e)}).prototype.addLogItemsToBuffer=function(e){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=e.length;return}if(null!=t.maxMessages){if(t.maxMessages<1)return;t.maxMessages-=e.length}this.batchBuffer=this.batchBuffer.concat(e);var n=this;L(this.batchTimeoutTimer,this.batchTimeout,function(){n.sendBatch.call(n)})},T.prototype.batchBufferHasOverdueMessages=function(){for(var e=0;e<this.batchBuffer.length;e++)if(t._getTime()-this.batchBuffer[e].t>this.batchTimeout)return!0;return!1},T.prototype.batchBufferHasStrandedMessage=function(){return null!=t.maxMessages&&t.maxMessages<1&&this.batchBuffer.length>0},T.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},T.prototype.onSendingEnded=function(){x(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},T.prototype.setOptions=function(e){if(s("level",e,this),s("ipRegex",e,this),s("userAgentRegex",e,this),s("disallow",e,this),s("sendWithBufferLevel",e,this),s("storeInBufferLevel",e,this),s("bufferSize",e,this),s("batchSize",e,this),s("maxBatchSize",e,this),s("batchTimeout",e,this),s("sendTimeout",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new t.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},T.prototype.log=function(e,t,n,i,r,s,h){var u;if(o(this)&&a(this,s)&&!(r<this.storeInBufferLevel)){if(u=b(r,s,h),r<this.level){this.bufferSize>0&&(this.buffer.push(u),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([u]),r>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},T.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)){if(x(this.batchTimeoutTimer),0!=this.batchBuffer.length){this.nbrLogItemsBeingSent=this.batchBuffer.length;var e=this;L(this.sendTimeoutTimer,this.sendTimeout,function(){e.onSendingEnded.call(e)}),this.sendLogItems(this.batchBuffer,function(){e.batchBuffer.splice(0,e.nbrLogItemsBeingSent),e.nbrLogItemsSkipped>0&&(e.batchBuffer.push(b(g(),"Lost "+e.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",e.appenderName)),e.nbrLogItemsSkipped=0),e.onSendingEnded.call(e)})}}},T);t.Appender=E;var O=function(e){function n(t){return e.call(this,t,n.prototype.sendLogItemsAjax)||this}return i(n,e),n.prototype.setOptions=function(t){return s("url",t,this),s("beforeSend",t,this),e.prototype.setOptions.call(this,t),this},n.prototype.sendLogItemsAjax=function(e,n){try{if(!o(this))return;this.xhr&&0!=this.xhr.readyState&&4!=this.xhr.readyState&&this.xhr.abort(),this.xhr=t._createXMLHttpRequest();var i="/jsnlog.logger";null!=t.defaultAjaxUrl&&(i=t.defaultAjaxUrl),this.url&&(i=this.url),this.xhr.open("POST",i),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",t.requestId);var r=this;this.xhr.onreadystatechange=function(){4==r.xhr.readyState&&r.xhr.status>=200&&r.xhr.status<300&&n()};var s={r:t.requestId,lg:e};"function"==typeof this.beforeSend?this.beforeSend.call(this,this.xhr,s):"function"==typeof t.defaultBeforeSend&&t.defaultBeforeSend.call(this,this.xhr,s);var a=JSON.stringify(s);this.xhr.send(a)}catch(h){}},n}(E);t.AjaxAppender=O;var z,A=function(e){function n(t){return e.call(this,t,n.prototype.sendLogItemsConsole)||this}return i(n,e),n.prototype.clog=function(e){t._console.log(e)},n.prototype.cerror=function(e){t._console.error?t._console.error(e):this.clog(e)},n.prototype.cwarn=function(e){t._console.warn?t._console.warn(e):this.clog(e)},n.prototype.cinfo=function(e){t._console.info?t._console.info(e):this.clog(e)},n.prototype.cdebug=function(e){t._console.debug?t._console.debug(e):this.cinfo(e)},n.prototype.sendLogItemsConsole=function(e,n){try{if(!o(this)||!t._console)return;for(i=0;i<e.length;++i){var i,r=e[i],s=r.n+": "+r.m;"undefined"==typeof window&&(s=new Date(r.t)+" | "+s),r.l<=t.getDebugLevel()?this.cdebug(s):r.l<=t.getInfoLevel()?this.cinfo(s):r.l<=t.getWarnLevel()?this.cwarn(s):this.cerror(s)}}catch(a){}n()},n}(E);t.ConsoleAppender=A;var j=((z=function(e){this.loggerName=e,this.seenRegexes=[]}).prototype.setOptions=function(e){return s("level",e,this),s("userAgentRegex",e,this),s("disallow",e,this),s("ipRegex",e,this),s("appenders",e,this),s("onceOnly",e,this),this.seenRegexes=[],this},z.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},z.prototype.log=function(e,t,n){var i,r,s=0;if(!this.appenders)return this;if(e>=this.level&&o(this)&&(n?(r=this.buildExceptionObject(n)).logData=h(t):r=t,i=u(r),a(this,i.finalString))){if(this.onceOnly)for(s=this.onceOnly.length-1;s>=0;){if(RegExp(this.onceOnly[s]).test(i.finalString)){if(this.seenRegexes[s])return this;this.seenRegexes[s]=!0}s--}for(i.meta=i.meta||{},s=this.appenders.length-1;s>=0;)this.appenders[s].log(y(e),i.msg,i.meta,function(){},e,i.finalString,this.loggerName),s--}return this},z.prototype.trace=function(e){return this.log(l(),e)},z.prototype.debug=function(e){return this.log(p(),e)},z.prototype.info=function(e){return this.log(d(),e)},z.prototype.warn=function(e){return this.log(g(),e)},z.prototype.error=function(e){return this.log(m(),e)},z.prototype.fatal=function(e){return this.log($(),e)},z.prototype.fatalException=function(e,t){return this.log($(),e,t)},z);t.Logger=j,t.createAjaxAppender=S,t.createConsoleAppender=B,r="undefined"!=typeof window?new O(""):new A(""),t.__=new t.Logger(""),t.__.setOptions({level:t.getDebugLevel(),appenders:[r]})}(r||(r={})),"undefined"!=typeof exports&&(exports.__esModule=!0,exports.JL=r),"function"==typeof t&&t.amd&&t("jsnlog",[],function(){return r}),"function"==typeof __jsnlog_configure&&__jsnlog_configure(r),"undefined"==typeof window||window.onerror||(window.onerror=function(e,t,n,i,s){return r("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:e?e.message||e:"",url:t,"line number":n,column:i},s),!1}),"undefined"==typeof window||window.onunhandledrejection||(window.onunhandledrejection=function(e){r("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:e.reason?e.reason.message:e.message||null},e.reason)})
"use strict";!function(){var t=function(){var t,i=Array.prototype.slice.call(document.querySelectorAll(".editor:not(.loaded)"));for(t=0;t<i.length;t++)new e(i[t])},e=function(t){this.mdrequest=null,this.target=t,this.target.classList.add("loaded"),this.editorInput=document.createElement("div"),this.editorInput.classList.add("liveEditor","box","p-0","pb-2"),this.editorBody=document.createElement("div"),this.editorBody.classList.add("liveEditor-body","p-2"),this.editorText=document.createElement("textarea"),this.editorText.classList.add("textarea");var e="";this.target.querySelectorAll("textarea").length>0&&(e=this.target.querySelector("textarea").value,this.target.querySelector("textarea").remove()),this.editorText.setAttribute("id",this.target.getAttribute("data-inputId")),this.editorText.setAttribute("name",this.target.getAttribute("data-inputName")),this.editorBody.append(this.editorText);var i=this;i.editorPrev=document.createElement("div"),this.editorPrev.classList.add("editor-liveEditorPrev","is-hidden","p-2","content"),this.editorPrevText=document.createElement("div"),this.editorPrev.append(this.editorPrevText),this.btn=document.createElement("div"),this.btn.classList.add("liveEditor-btnGrp","has-background-white-ter","is-flex","is-justify-content-space-between"),this.btnLeft=document.createElement("span"),this.btnLeft.classList.add("is-flex"),this.btnRight=document.createElement("span"),this.btnRight.classList.add("is-flex"),this.btn.append(this.btnLeft),this.btn.append(this.btnRight),this.btnBold=document.createElement("button"),this.btnBold.classList.add("liveEditor-btn","button","is-light"),this.btnBold.setAttribute("type","button"),this.btnBold.innerHTML='<span class="icon"><i class="fas fa-bold"></i></span>',this.btnLeft.append(this.btnBold),this.btnBold.addEventListener("click",this.insertBold.bind(this),!1),this.btnItalic=document.createElement("button"),this.btnItalic.classList.add("liveEditor-btn","button","is-light"),this.btnItalic.setAttribute("type","button"),this.btnItalic.innerHTML='<span class="icon"><i class="fas fa-italic"></i></span>',this.btnLeft.append(this.btnItalic),this.btnItalic.addEventListener("click",this.insertItalics.bind(this),!1),this.btnHeading=document.createElement("button"),this.btnHeading.classList.add("liveEditor-btn","button","is-light"),this.btnHeading.setAttribute("type","button"),this.btnHeading.innerHTML='<span class="icon"><i class="fas fa-heading"></i></span>',this.btnLeft.append(this.btnHeading),this.btnHeading.addEventListener("click",this.insertHeading.bind(this),!1),this.btnHeadingSep=document.createElement("span"),this.btnHeadingSep.classList.add("liveEditor-btnSep"),this.btnLeft.append(this.btnHeadingSep),this.btnQuote=document.createElement("button"),this.btnQuote.classList.add("liveEditor-btn","button","is-light"),this.btnQuote.setAttribute("type","button"),this.btnQuote.innerHTML='<span class="icon"><i class="fas fa-quote-left"></i></span>',this.btnLeft.append(this.btnQuote),this.btnQuote.addEventListener("click",this.insertQuote.bind(this),!1),this.btnCode=document.createElement("button"),this.btnCode.classList.add("liveEditor-btn","button","is-light"),this.btnCode.setAttribute("type","button"),this.btnCode.innerHTML='<span class="icon"><i class="fas fa-code"></i></span>',this.btnLeft.append(this.btnCode),this.btnCode.addEventListener("click",this.insertCode.bind(this),!1),this.btnCodeSep=document.createElement("span"),this.btnCodeSep.classList.add("liveEditor-btnSep"),this.btnLeft.append(this.btnCodeSep),this.btnUl=document.createElement("button"),this.btnUl.classList.add("liveEditor-btn","button","is-light"),this.btnUl.setAttribute("type","button"),this.btnUl.innerHTML='<span class="icon"><i class="fas fa-list-ul"></i></span>',this.btnLeft.append(this.btnUl),this.btnUl.addEventListener("click",this.insertUl.bind(this),!1),this.btnOl=document.createElement("button"),this.btnOl.classList.add("liveEditor-btn","button","is-light"),this.btnOl.setAttribute("type","button"),this.btnOl.innerHTML='<span class="icon"><i class="fas fa-list-ol"></i></span>',this.btnLeft.append(this.btnOl),this.btnOl.addEventListener("click",this.insertOl.bind(this),!1),this.btnOlSep=document.createElement("span"),this.btnOlSep.classList.add("liveEditor-btnSep"),this.btnLeft.append(this.btnOlSep),this.btnLink=document.createElement("button"),this.btnLink.classList.add("liveEditor-btn","button","is-light"),this.btnLink.setAttribute("type","button"),this.btnLink.innerHTML='<span class="icon"><i class="fas fa-link"></i></span>',this.btnLeft.append(this.btnLink),this.btnLink.addEventListener("click",this.insertLink.bind(this),!1),this.editorInput.append(this.btn),this.target.getAttribute("data-saveUrl")&&(this.btnSave=document.createElement("button"),this.btnSave.classList.add("liveEditor-btn","button","is-light"),this.btnSave.classList.add("save"),this.btnSave.setAttribute("type","button"),this.btnSave.innerHTML='<span class="icon"><i class="fas fa-floppy-disk"></i></span>',this.btnSave.addEventListener("click",this.save.bind(this),!1),this.btnRight.append(this.btnSave),this.saveUrl=this.target.getAttribute("data-saveUrl")),this.editorPrevTitleButton=document.createElement("button"),this.editorPrevTitleButton.setAttribute("type","button"),this.editorPrevTitleButton.innerHTML='<span class="icon"><i class="fas fa-eye"></i></span>',this.editorPrevTitleButton.classList.add("liveEditor-btn","button","is-light"),this.editorPrevTitleButton.classList.add("save"),this.btnRight.append(this.editorPrevTitleButton),this.editorInput.append(this.editorBody),this.target.append(this.editorInput),this.editorInput.append(this.editorPrev),this.mirror=CodeMirror.fromTextArea(this.editorText,{mode:"gfm",autoRefresh:!0,viewportMargin:1/0,lineWrapping:!0}),this.mirror.setValue(e),this.mirror.getInputField().spellcheck=!0;var r=require("markdown-it")({html:!0,breaks:!1,linkify:!0,typographer:!0});this.md=r.use(require("@toycode/markdown-it-class"),{h1:"title is-1",h2:"title is-2",h3:"title is-3",h4:"title is-4",h5:"title is-5",h6:"title is-5",p:"block",table:"table"}),this.editorPrevTitleButton.addEventListener("click",this.updateMirror.bind(this),!1),this.target.closest(".mdl")&&this.target.closest(".mdl").addEventListener("mdl-open",this.updateMirror.bind(this))},i=0;function r(){if(50===i)return!1;"undefined"==typeof CodeMirror?setTimeout(function(){i++,r()},100):(i=0,t())}var n=document.requestAnimationFrame||document.setImmediate||function(t){return setTimeout(t,0)};e.prototype={updateMirror:function(){var t=this,e=this.md,i=this.editorPrevTitleButton;n(function(){var r=i.querySelector("i.fas");r.classList.contains("fa-eye")?(t.editorPrevText.innerHTML=e.render(t.mirror.getValue()),r.classList.remove("fa-eye"),r.classList.add("fa-eye-slash"),t.editorPrev.classList.remove("is-hidden"),t.editorBody.classList.add("is-hidden"),(t.btnLeft.querySelectorAll("button")||[]).forEach(function(t){t.setAttribute("disabled","disabled")}),document.dispatchEvent(new CustomEvent("code-highlight")),document.dispatchEvent(new CustomEvent("load-charts"))):(r.classList.remove("fa-eye-slash"),r.classList.add("fa-eye"),t.editorPrev.classList.add("is-hidden"),(t.btnLeft.querySelectorAll("button")||[]).forEach(function(t){t.removeAttribute("disabled")}),t.editorBody.classList.remove("is-hidden"))})},insertBold:function(){var t=this;n(function(){var e=t.mirror.findWordAt(t.mirror.getCursor()),i=t.mirror.getSelection().trim();t.mirror.getSelection().length>0?t.mirror.replaceSelection("**"+t.mirror.getSelection().trim()+"**"):(t.mirror.setSelection(e.anchor,e.head),""===i&&(i="bold text"),t.mirror.replaceSelection("**"+i+"**")),t.mirror.focus()})},insertItalics:function(){var t=this;n(function(){var e=t.mirror.findWordAt(t.mirror.getCursor()),i=t.mirror.getSelection().trim();t.mirror.getSelection().length>0?t.mirror.replaceSelection("*"+t.mirror.getSelection().trim()+"*"):(t.mirror.setSelection(e.anchor,e.head),""===i&&(i="italic text"),t.mirror.replaceSelection("*"+i+"*")),t.mirror.focus()})},insertHeading:function(){var t=this;n(function(){var e=t.mirror.getCursor().line,i=t.mirror.getLine(e),r=i.split(" ")[0];""===i?t.mirror.replaceRange("# Heading",{line:e,ch:0}):"#"===r[0]?(r.match(/#/g)||[]).length>=6?t.mirror.replaceRange(i.slice(Math.max(0,i.indexOf(" ")+1)),{line:e,ch:0},{line:e,ch:i.length}):t.mirror.replaceRange("#",{line:e,ch:0}):t.mirror.replaceRange("# ",{line:e,ch:0}),t.mirror.focus()})},insertQuote:function(){var t=this;n(function(){var e=t.mirror.findWordAt(t.mirror.getCursor()),i=t.mirror.getSelection().trim();t.mirror.getSelection().length>0?(t.mirror.setSelection({line:Math.min(t.mirror.listSelections()[0].head.line,t.mirror.listSelections()[0].anchor.line),ch:0},{line:Math.max(t.mirror.listSelections()[0].head.line,t.mirror.listSelections()[0].anchor.line),ch:1}),t.mirror.replaceSelection("> "+t.mirror.getSelection().replace(/\n/g,function(){return"\n> "}))):(t.mirror.setSelection({line:Math.min(e.head.line,e.anchor.line),ch:0},{line:Math.max(e.head.line,e.anchor.line),ch:1}),""===i?t.mirror.replaceSelection("> fancy blockquote"):t.mirror.replaceSelection("> "+i)),t.mirror.focus()})},insertCode:function(){var t=this;n(function(){var e=t.mirror.findWordAt(t.mirror.getCursor()),i=t.mirror.getSelection().trim();t.mirror.getSelection().length>0?t.mirror.replaceSelection("\n```sql\n"+t.mirror.getSelection()+"\n```\n"):(t.mirror.setSelection(e.anchor,e.head),""===i?t.mirror.replaceSelection("\n```sql\nselect smiles; -- :) --\n```\n"):t.mirror.replaceSelection("`"+i+"`")),t.mirror.focus()})},insertUl:function(){var t=this;n(function(){var e=t.mirror.findWordAt(t.mirror.getCursor()),i=t.mirror.getSelection().trim();t.mirror.getSelection().length>0?(t.mirror.setSelection({line:Math.min(t.mirror.listSelections()[0].head.line,t.mirror.listSelections()[0].anchor.line),ch:0},{line:Math.max(t.mirror.listSelections()[0].head.line,t.mirror.listSelections()[0].anchor.line),ch:1}),t.mirror.replaceSelection("- "+t.mirror.getSelection().replace(/\n/g,function(){return"\n- "}))):(t.mirror.setSelection({line:Math.min(e.head.line,e.anchor.line),ch:0},{line:Math.max(e.head.line,e.anchor.line),ch:1}),""===i?t.mirror.replaceSelection("- item one\n- item two\n- item three"):t.mirror.replaceSelection("- "+i)),t.mirror.focus()})},insertOl:function(){var t=this;n(function(){var e=t.mirror.findWordAt(t.mirror.getCursor()),i=t.mirror.getSelection().trim();if(t.mirror.getSelection().length>0){t.mirror.setSelection({line:Math.min(t.mirror.listSelections()[0].head.line,t.mirror.listSelections()[0].anchor.line),ch:0},{line:Math.max(t.mirror.listSelections()[0].head.line,t.mirror.listSelections()[0].anchor.line),ch:1});var r=1;t.mirror.replaceSelection(r+". "+t.mirror.getSelection().replace(/\n/g,function(){return"\n"+ ++r+". "}))}else t.mirror.setSelection({line:Math.min(e.head.line,e.anchor.line),ch:0},{line:Math.max(e.head.line,e.anchor.line),ch:1}),""===i?t.mirror.replaceSelection("1. item one\n2. item two\n3. item three"):t.mirror.replaceSelection("1. "+i);t.mirror.focus()})},insertLink:function(){var t=this;n(function(){t.mirror.getSelection().length>0?t.mirror.replaceSelection("["+t.mirror.getSelection().trim()+"](https://atlas)"):t.mirror.replaceSelection("[Link Title](https://atlas)"),t.mirror.focus()})},save:function(){var t=this;n(function(){var e={};e.id=getUrlVars().id,e.description=t.mirror.getValue();var i=new XMLHttpRequest;i.open("post",t.saveUrl,!0),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8`"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("X-CSRFToken",csrftoken),i.send(JSON.stringify(e)),i.addEventListener("load",function(){document.querySelector("#editorMdl-titleSave").style.visibility="visible",setTimeout(function(){document.querySelector("#editorMdl-titleSave").style.removeProperty("visibility")},750)})})}},r(),document.addEventListener("ajax",function(){r()})}(),function(){var t=document,e=function(t){t.classList.add("loaded");var e=t.querySelector("input[type=checkbox]"),i=t.querySelector("input[type=hidden");e&&i&&(e.checked="Y"===i.value,e.addEventListener("change",function(){i.value=e.checked?"Y":"N",i.dispatchEvent(new CustomEvent("change"))}))},i=function(){for(var i=t.querySelectorAll(".toggle"),r=0;r<i.length;r++)e(i[r])};i(),t.addEventListener("ajax",function(){i()})}(),function(){var t=function(t){for(var e=t.querySelectorAll('input[type="hidden"][name]:not(.drag)'),i=0;i<e.length;i++)e[i].setAttribute("name",e[i].getAttribute("name").replace(/\[\d*?]/,"["+i+"]"))};(document.querySelector("#images .images.reorder")||{addEventListener:function(){}}).addEventListener("reorder",function(e){t(e.target)}),(document.querySelector(".new-image input")||{addEventListener:function(){}}).addEventListener("change",function(e){e.preventDefault();var i=document.createElement("div");i.classList.add("box","p-0","m-3","drg");var r=document.createElement("input");r.type="hidden",r.setAttribute("name","Images[999].Imageid");var n=document.createElement("div");n.classList.add("has-background-white-ter","is-flex","is-justify-content-space-between");var s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("button","is-light","drg-hdl"),s.innerHTML='<span class="icon"><i class="fas fa-up-down-left-right"></i></span>';var o=document.createElement("button");o.setAttribute("type","button"),o.classList.add("button","is-light","action-delete"),o.innerHTML='<span class="icon"><i class="fas fa-circle-notch fa-spin"></i></span>';var a=document.createElement("figure");a.classList.add("image","is-256x256");var l=document.createElement("picture"),c=document.createElement("img");c.setAttribute("src",window.URL.createObjectURL(e.target.files[0])),c.style.width="auto",c.style.maxWidth="100%",c.style.maxHeight="100%",i.append(r),i.append(n),n.append(s),n.append(o),i.append(a),a.append(l),l.append(c);var d=document.querySelector(".images.reorder .new-image").closest(".box");d.parentNode.insertBefore(i,d);var h=new FormData;h.append("File",e.target.files[0]);var m=new XMLHttpRequest;m.open("post","/reports/edit/?handler=AddImage&Id="+getUrlVars().id,!0),m.withCredentials=!0,m.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.setRequestHeader("X-CSRFToken",csrftoken),m.send(h),m.addEventListener("load",function(){"error"===m.responseText?o.innerHTML='<span class="icon has-text-danger"><i class="fas fa-exclamation-triangle"></i></span>':(o.innerHTML='<span class="icon"><i class="fas fa-trash"></i></span>',r.value=m.responseText,o.addEventListener("click",function(t){t.preventDefault(),i.remove()}))}),t(document.querySelector(".images.reorder"))}),(document.querySelectorAll(".images button.action-delete")||[]).forEach(function(t){t.addEventListener("click",function(e){e.preventDefault(),t.closest(".box").remove()})})}()